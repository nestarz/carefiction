import{useState,useRef,useEffect,useCallback,createContext,useContext,createElement,isValidElement,cloneElement,useLayoutEffect}from"react";var locationHook=({base:e=""}={})=>{const[t,r]=useState(currentPathname(e)),n=useRef(t);return useEffect(()=>{patchHistoryEvents();const t=()=>{const t=currentPathname(e);n.current!==t&&r(n.current=t)},o=["popstate","pushState","replaceState"];return o.map(e=>addEventListener(e,t)),t(),()=>o.map(e=>removeEventListener(e,t))},[]),[t,useCallback((t,r)=>history[r?"replaceState":"pushState"](0,0,e+t),[])]};let patched=0;const patchHistoryEvents=()=>{if(!patched)return["pushState","replaceState"].map(e=>{const t=history[e];history[e]=function(){const r=t.apply(this,arguments),n=new Event(e);return n.arguments=arguments,dispatchEvent(n),r}}),patched=1},currentPathname=(e,t=location.pathname)=>t.indexOf(e)?t:t.slice(e.length)||"/";function makeMatcher(e=pathToRegexp){let t={};return(r,n)=>{const{regexp:o,keys:u}=(r=>t[r]||(t[r]=e(r)))(r||""),a=o.exec(n);return a?[!0,u.reduce((e,t,r)=>(e[t.name]=a[r+1],e),{})]:[!1,null]}}const escapeRx=e=>e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),rxForSegment=(e,t,r)=>{let n=e?"((?:[^\\/]+?)(?:\\/(?:[^\\/]+?))*)":"([^\\/]+?)";return t&&r&&(n="(?:\\/"+n+")"),n+(t?"?":"")},pathToRegexp=e=>{const t=/:([A-Za-z0-9_]+)([?+*]?)/g;let r=null,n=0,o=[],u="";for(;null!==(r=t.exec(e));){const[a,c,s]=r,l="+"===s||"*"===s,i="?"===s||"*"===s,h=i&&"/"===e[r.index-1]?1:0,p=e.substring(n,r.index-h);o.push({name:c}),n=t.lastIndex,u+=escapeRx(p)+rxForSegment(l,i,h)}return u+=escapeRx(e.substring(n)),{keys:o,regexp:new RegExp("^"+u+"(?:\\/)?$","i")}},RouterCtx=createContext({}),buildRouter=({hook:e=locationHook,base:t="",matcher:r=makeMatcher()}={})=>({hook:e,base:t,matcher:r}),useRouter=()=>{const e=useContext(RouterCtx);return e.v||(e.v=buildRouter())},useLocation=()=>{const e=useRouter();return e.hook(e)},useRoute=e=>{const[t]=useLocation();return useRouter().matcher(e,t)},Router=e=>{const t=useRef(null),r=t.current||(t.current={v:buildRouter(e)});return createElement(RouterCtx.Provider,{value:r,children:e.children})},Route=({path:e,match:t,component:r,children:n})=>{const o=useRoute(e),[u,a]=t||o;return u?r?createElement(r,{params:a}):"function"==typeof n?n(a):n:null},Link=e=>{const[,t]=useLocation(),{base:r}=useRouter(),n=e.href||e.to,{children:o,onClick:u}=e,a=useCallback(e=>{e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||0!==e.button||(e.preventDefault(),t(n),u&&u(e))},[n,u,t]),c={href:r+n,onClick:a,to:null},s=isValidElement(o)?o:createElement("a",e);return cloneElement(s,c)},Switch=({children:e,location:t})=>{const{matcher:r}=useRouter(),[n]=useLocation();e=Array.isArray(e)?e:[e];for(const o of e){let e=0;if(isValidElement(o)&&o.props.path&&(e=r(o.props.path,t||n))[0])return cloneElement(o,{match:e})}return null},Redirect=e=>{const[,t]=useLocation();return useLayoutEffect(()=>{t(e.href||e.to)},[]),null};export default useRoute;export{Link,Redirect,Route,Router,Switch,useLocation,useRoute,useRouter};