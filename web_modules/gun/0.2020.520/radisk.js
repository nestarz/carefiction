!function(){function e(n){(n=n||{}).log=n.log||console.log,n.file=String(n.file||"radata");var r=(e.has||(e.has={}))[n.file];if(r)return r;function o(e){return encodeURIComponent(e).replace(/\*/g,"%2A")}n.pack=n.pack||.3*(n.memory?1e3*n.memory*1e3:1399e6),n.until=n.until||n.wait||250,n.batch=n.batch||1e4,n.chunk=n.chunk||1048576,n.code=n.code||{},n.code.from=n.code.from||"!",n.jsonify=!0;var a="undefined"==typeof setImmediate?setTimeout:setImmediate,f=setTimeout.puff||a,s=(t.obj.map,t.obj.empty),c=0;if(!n.store)return n.log("ERROR: Radisk needs `opt.store` interface with `{get: fn, put: fn (, list: fn)}`!");if(!n.store.put)return n.log("ERROR: Radisk needs `store.put` interface with `(file, data, cb)`!");if(!n.store.get)return n.log("ERROR: Radisk needs `store.get` interface with `(file, cb)`!");n.store.list;var d=function(e,n,t,i,r){if("function"==typeof n){var o=t||{};return t=n,void d.read(e,t,o,r||i)}d.save(e,n,t,i,r)};d.save=function(e,t,r,a,f){var c,l,u={key:e};u.find=function(e){var t;u.file=e||(e=n.code.from),f&&(f=f[e]=f[e]||{}),f&&(f.sf=f.sf||+new Date),(t=d.disk[e])?u.mix(v,t):d.parse(e,u.mix,v,f)},u.mix=function(o,s){if(f&&(f.sml=+new Date),f&&(f.sm=f.sm||+new Date),u.err=o||u.err)r(o);else{var c,l=u.file=(s||"").file||u.file;if(!s&&l!==n.code.from)return d.find.bad(l),void d.save(e,t,r,a);(s=d.disk[l]||(d.disk[l]=s||i())).file||(s.file=l),n.compare&&(t=n.compare(s(e),t,e,l),v===t)?r(o,-1):((u.disk=s)(e,t),a&&((c=(c=s.tags||(s.tags={}))[a]||(c[a]=d.tags[a]||(d.tags[a]={})))[l]||(c[l]=d.one[a]||(d.one[a]=r)),r=null),f&&(f.st=f.st||+new Date),s.Q?r&&s.Q.push(r):(s.Q=r?[r]:[],s.to=setTimeout(u.write,n.until)))}},u.write=function(){f&&(f.sto=f.sto||+new Date);var e=c=u.file,n=u.disk;l=u.q=n.Q,u.tags=n.tags,delete n.Q,delete d.disk[e],delete n.tags,d.write(e,n,u.ack,v,f)},u.ack=function(e,n){var t,i;for(var r in f&&(f.sa=f.sa||+new Date),f&&(f.sal=l.length),d.tags)if(d.tags.hasOwnProperty(r)){var a=d.tags[r];(i=d.disk[c])&&(i=i.tags)&&i[a]||(t=a[c],delete a[c],s(a)&&(delete d.tags[a],t&&t(e,n)))}!l&&(l="");for(var w=l.length,p=0,v=+new Date;p<w;p++)(t=l[p])&&t(e,n);console.STAT&&console.STAT(v,+new Date-v,"rad acks",o(u.file)),console.STAT&&console.STAT(v,l.length,"rad acks #",o(u.file))},r||(r=function(e,n){}),d.find(e,u.find)},d.disk={},d.one={},d.tags={};var l,u,w,p=0;d.write=function(t,r,a,f,s){if(r){f="object"==typeof f?f:{force:f};var l,u,w=function(){};w.text="",w.file=t=r.file||(r.file=t),t?(w.write=function(){var e=r.raw=w.text;d.disk[t=r.file||w.file||t]=r;var i=+new Date;s&&(s.wd=i),d.find.add(t,function(f){s&&(s.wa=+new Date),f?a(f):n.store.put(o(t),e,function(e,n){s&&(s.wp=+new Date),console.STAT&&console.STAT(i,c=+new Date-i,"wrote disk",JSON.stringify(t),++p,"total all writes."),a(e,n||1),r.Q||delete d.disk[t]})})},w.split=function(){var e=+new Date;s&&(s.wf=e),w.text="",w.count||(w.count=0,i.map(r,function(){w.count++})),s&&(s.wfc=w.count),w.limit=Math.ceil(w.count/2);var n=w.count;return w.count=0,s&&(s.wf1=+new Date),w.sub=i(),i.map(r,w.slice,{reverse:1}),s&&(s.wf2=+new Date),d.write(w.end,w.sub,w.both,f),s&&(s.wf3=+new Date),w.hub=i(),i.map(r,w.stop),s&&(s.wf4=+new Date),d.write(r.file,w.hub,w.both,f),s&&(s.wf5=+new Date),console.STAT&&console.STAT(e,+new Date-e,"rad split",o(r.file),n),!0},w.slice=function(e,n){if(w.sub(w.end=n,e),w.limit<=++w.count)return!0},w.stop=function(e,n){if(n>=w.end)return!0;w.hub(n,e)},w.both=function(e,n){s&&(s.wfd=+new Date),u?a(e||u):l?a(e,n):(l=!0,u=e)},w.each=function(t,i,r,o){if(v!==t&&w.count++,n.pack<=(t||"").length)return a("Data too big!"),!0;var s=e.encode(o.length)+"#"+e.encode(r)+(v===t?"":":"+e.encode(t))+"\n";if(n.chunk<w.text.length+s.length&&1<w.count&&!f.force)return w.split();w.text+=s},n.jsonify?d.write.jsonify(w,r,a,f,s):i.map(r,w.each,!0)||w.write()):a("What file?")}else a("No radix!")},d.write.jsonify=function(e,t,r,o,a){var f,s=+new Date;a&&(a.w=s);try{f=JSON.stringify(t.$)}catch(e){return void r("Cannot radisk!")}if(a&&(a.ws=+new Date),console.STAT&&console.STAT(s,+new Date-s,"rad stringified JSON"),n.chunk<f.length&&!o.force){var c=0;if(i.map(t,function(){if(c++)return!0}),c>1)return e.split()}e.text=f,e.write()},d.range=function(e,n){if(e&&n){if(v===n.start&&v===n.end)return e;if(v!==(t=e)&&(!t||"object"!=typeof t))return e;var t,r=i();return i.map(e,function(e,n){r(n,e)},n),r("")}},function(){d.read=function(e,r,s,c){s=s||{};var l={key:e,find:function(e){var t;l.file=e||(e=n.code.from),c&&(c=c[e]=c[e]||{}),c&&(c.rf=c.rf||+new Date),(t=d.disk[l.file=e])?l.check(v,t):d.parse(e,l.check,v,c)},get:function(t,o,f){if(c&&(c.rgl=+new Date),c&&(c.rg=c.rg||+new Date),l.err=t||l.err)r(t);else{var u=l.file=(o||"").file||l.file;if(!o&&u!==n.code.from)return d.find.bad(u),void d.read(e,r,s);if(o=d.disk[u]||(d.disk[u]=o)){o.file||(o.file=u);var w=d.range(o(e),s);if(c&&(c.rr=+new Date),s.unit=o.unit,s.chunks=(s.chunks||0)+1,s.parsed=(s.parsed||0)+((f||"").parsed||s.chunks*n.chunk),s.more=1,s.next=v,i.map(d.list,function(e,n){if(e&&u!==n)return s.next=n,1},s.reverse?{reverse:1,end:u}:{start:u}),c&&(c.rl=+new Date),s.next||(s.more=0),s.next&&((!s.reverse&&e<s.next&&0!=s.next.indexOf(e)||v!==s.end&&(s.end||"ï¿¿")<s.next)&&(s.more=0),(s.reverse&&e>s.next&&0!=e.indexOf(s.next)||v!==s.start&&(s.start||"")>s.next)&&(s.more=0)),s.more){if(w&&r(l.err,w,s),!(s.parsed>=s.limit)){var p=+new Date;c&&(c.rm=p);var m=s.next;a(function(){console.STAT&&console.STAT(p,+new Date-p,"rad more"),d.parse(m,l.check)},0)}}else r(l.err,w,s)}else r(u===n.code.from?v:"No file!")}},check:function(e,r,a){if(l.get(e,r,a),r&&!r.check){r.check=1;var s=+new Date;(a||(a={})).file||(a.file=l.file),i.map(r,function(e,i){d.find(i,function(r){if((r||(r=n.code.from))!==a.file){var s=t.text.random(3);f(function(){d.save(i,e,function n(t,f){t?d.save(i,e,n):console.STAT&&console.STAT("MISLOCATED DATA CORRECTED",s,o(i),o(a.file),o(r))})},0)}})}),console.STAT&&console.STAT(s,+new Date-s,"rad check")}}};d.find(e,l.find)}}(),l=0,u={},w=String.fromCharCode(31),d.parse=function(t,r,a,s){var p;if(!t)return r();if(p=u[t])p.push(r);else{p=u[t]=[r];var m=function(){},g={file:t};(m.disk=i()).file=t,m.read=function(e,i){var r;if(s&&(s.rpg=+new Date),console.STAT&&console.STAT(h,+new Date-h,"read disk",JSON.stringify(t),++l,"total all parses."),delete u[t],(m.err=e)||(m.not=!i))m.map(p,m.ack);else{if("string"!=typeof i){try{n.pack<=i.length?m.err="Chunk too big!":i=i.toString()}catch(e){m.err=e}if(m.err)return void m.map(p,m.ack)}if(g.parsed=i.length,s&&(s.rpl=g.parsed),s&&(s.rpa=p.length),h=+new Date,n.jsonify||"{"===i[0]){try{var o=JSON.parse(i);return m.disk.$=o,console.STAT&&(c=+new Date-h)>9&&console.STAT(h,c,"rad parsed JSON"),s&&(s.rpd=+new Date),void m.map(p,m.ack)}catch(e){r=e}if("{"===i[0])return m.err=r||"JSON error!",void m.map(p,m.ack)}m.radec(e,i)}},m.map=function(){if(p&&p.length){for(var e,n=+new Date,i=m.err,r=m.not?v:m.disk,a=0;a<9&&(e=p[a++]);)e(i,r,g);console.STAT&&console.STAT(n,+new Date-n,"rad packs",o(t)),console.STAT&&console.STAT(n,a,"rad packs #",o(t)),(p=p.slice(a)).length&&f(m.map,0)}},m.ack=function(e){e&&(m.err||m.not?e(m.err,v,g):e(v,m.disk,g))},m.radec=function(e,n){h=+new Date;var i,r,o,a=m.split(n),f=[];if(!a||0!==a[1])return m.err="File '"+t+"' does not have root radix! ",void m.map(p,m.ack);for(;a;)r=o=v,i=a[1],"#"==(a=m.split(a[2])||"")[0]&&(r=a[1],i<=(f=f.slice(0,i)).length&&f.push(r)),"\n"!=(a=m.split(a[2])||"")[0]&&("="!=a[0]&&":"!=a[0]||(o=a[1]),v!==r&&v!==o&&m.disk(f.join(""),o),a=m.split(a[2]));console.STAT&&console.STAT(h,+new Date-h,"parsed RAD"),m.map(p,m.ack)},m.split=function(n){if(n){var t,i,r=[],o={};if(t=n.indexOf(w),n[t])return i=n.slice(0,t),r[0]=i,r[1]=e.decode(n.slice(t),o),r[2]=n.slice(t+o.i),r}},d.disk&&(a||(a=(d.disk[t]||"").raw));var h=+new Date;if(s&&(s.rp=h),a)return f(function(){m.read(v,a)},0);n.store.get(o(t),m.read)}},function(){var e,r,o=String.fromCharCode(28);function a(t,r){if(t)return n.log("list",t),void setTimeout(function(){d.parse(o,a)},1e3);r?f(r):(e=e||r||i(),n.store.list?n.store.list(function(n){n?d.find.add(n,m):f(e)}):f(e))}function f(n,i){(e=e||n).file=o,i=r,r=null,t.list.map(i,function(e){d.find(e[0],e[1])})}d.find=function(t,f){if(!e)return r?void r.push([t,f]):(r=[[t,f]],void d.parse(o,a));i.map(d.list=e,function(e,n){if(e)return f(n)||!0},{reverse:1,end:t})||f(n.code.from)},d.find.add=function(n,t){e(n)||n===o?t(v,1):(e(n,1),t.found=(t.found||0)+1,d.write(o,e,function(e,n){e?t(e):(t.found=(t.found||0)-1,0===t.found&&t(v,1))},!0))},d.find.bad=function(n,t){e(n,0),d.write(o,e,t||m)}}();try{!t.window&&require("./radmigtmp")(d)}catch(e){}var v,m=function(){};return e.has[n.file]=d,d}var n;if(n=String.fromCharCode(31),e.encode=function(e,i,r){var o,a=r=r||n;if("string"==typeof e){for(var f=e.indexOf(r);-1!=f;)a+=r,f=e.indexOf(r,f+1);return a+'"'+e+r}return e&&e["#"]&&(o=t.val.link.is(e))?a+"#"+o+a:t.num.is(e)?a+"+"+(e||0)+a:null===e?a+" "+a:!0===e?a+"+"+a:!1===e?a+"-"+a:void 0},e.decode=function(e,i,r){var o,a,f,s=-1,c=0;if((r=r||n)===e[0]){for(;r===e[++s];)++c;for(f=e[a=c]||!0;--c>=0;)s=e.indexOf(r,s+1);return-1==s&&(s=e.length),o=e.slice(a+1,s),i&&(i.i=s+1),'"'===f?o:"#"===f?t.val.link.ify(o):"+"===f?0===o.length||parseFloat(o):" "===f?null:"-"!==f&&void 0}},"undefined"!=typeof window){var t=window.Gun,i=window.Radix;window.Radisk=e}else{t=require("../gun"),i=require("./radix");try{module.exports=e}catch(e){}}e.Radix=i}()