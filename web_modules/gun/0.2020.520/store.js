t="undefined"!=typeof window?window.Gun:require("../gun");t.on("create",function(e){t.TESTING&&(e.opt.file="radatatest"),this.to.next(e);var n,o=e.opt;if(!1!==o.radisk){var i=t.window&&t.window.Radisk||require("./radisk"),a=i.Radix,s=i(o),r=String.fromCharCode(27),l=0;e.on("put",function(t){if(this.to.next(t),!(t._||"").rad){var n=t["#"],o=t.put,i=o["#"],a=o["."],l=o[":"],u=o[">"],g=(t._||"").DBG;g&&(g.sp=g.sp||+new Date);var f=(t._||"").lot||"";c[n]=(c[n]||0)+1;var d=(t._||"").RPS||((t._||"").RPS=+new Date);s(i+r+a,{":":l,">":u},s.one[n]||function(t,o){g&&(g.spd=g.spd||+new Date),console.STAT&&console.STAT(d,+new Date-d,"put"),t||c[n]===f.s||(console.log(t="Disk count not same as ram count."),console.STAT&&console.STAT(+new Date,f.s-c[n],"put ack != count")),delete c[n],t?e.on("in",{"@":n,err:t,DBG:g}):e.on("in",{"@":n,ok:o,DBG:g})},n,g&&(g.r=g.r||{})),g&&(g.sps=g.sps||+new Date)}});var c={};t.obj.empty;e.on("get",function(c){this.to.next(c);var g=(c._||"").DBG=c.DBG;g&&(g.sg=+new Date);var f,d,p,m,T=c["#"],w=c.get,D=c.get["#"],v=c.get["."]||"",S={};if("string"==typeof D?d=D:D&&(n!==(p=D["*"])&&(S.limit=m=1),n!==D[">"]&&(S.start=D[">"]),n!==D["<"]&&(S.end=D["<"]),d=m?""+p:p||D["="],m=null),d&&!S.limit&&("string"==typeof v?d=d+r+(S.atom=v):v&&(n!==v[">"]&&(S.start=v[">"],S.limit=1),n!==v["<"]&&(S.end=v["<"],S.limit=1),n!==(p=v["*"])&&(S.limit=m=1),d&&(d=d+r+(m?""+(p||""):p||(S.atom=v["="]||""))))),((p=w["%"])||S.limit)&&(S.limit=p<=(S.pack||1e5)?p:1),(v["-"]||(D||{})["-"])&&(S.reverse=!0),(p=(e.next||"")[D])&&p.put)if(S.atom){if((p=(p.next||"")[S.atom])&&p.rad)return}else if(p&&p.rad)return;var y=t.state(),A=+new Date,h=0;function _(e,n,o,a){if(h++,e){var s=(n=(d+n).split(r)).slice(0,1)[0];if(n=n.slice(-1)[0],S.limit&&S.limit<=S.count)return!0;var l,c,u=s,g=n;if("string"!=typeof e)return l=e[":"],c=e[">"],(f=f||{})[u]=t.state.ify(f[u],g,c,l,u),void(S.count=(S.count||0)+((l||"").length||9));S.count=(S.count||0)+e.length;var p=e.lastIndexOf(">"),m=i.decode(e.slice(p+1),null,r);e=i.decode(e.slice(0,p),null,r),(f=f||{})[s]=t.state.ify(f[s],n,m,e,s)}}g&&(g.sgm=A),s(d||"",function(i,s,c){g&&(g.sgr=+new Date),g&&(g.sgi=c);try{o.store.stats.get.time[u%50]=+new Date-A,++u,o.store.stats.get.count++,i&&(o.store.stats.get.err=i)}catch(t){}var p,m;if(console.STAT&&console.STAT(A,+new Date-A,"got",JSON.stringify(d)),A=+new Date,(c=c||"").unit&&s&&n!==(p=s[":"])&&n!==(m=s[">"])){var k=d.split(r),G=k[0],x=k[1];(f=f||{})[G]=t.state.ify(f[G],x,m,p,G),e.$.get(G).get(x)._.rad=y}else s&&("string"!=typeof s&&(S.atom?s=n:a.map(s,_)),!f&&s&&_(s,""),!S.atom&&!v&"string"==typeof D&&!S.limit&&!S.more&&(e.$.get(D)._.rad=y));g&&(g.sgp=+new Date),console.STAT&&(l=+new Date-A)>9&&(console.STAT(A,l,"got prep time"),console.STAT(A,h,"got prep #")),l,h=0,A=+new Date;var B=function(){};B.faith=!0,B.rad=w,e.on("in",{"@":T,put:f,"%":c.more?1:n,err:i||n,_:B,DBG:g}),console.STAT&&(l=+new Date-A)>9&&console.STAT(A,l,"got emit",Object.keys(f||{}).length),f=n},S,g&&(g.r=g.r||{})),g&&(g.sgd=+new Date),console.STAT&&(l=+new Date-A)>9&&console.STAT(A,l,"get call")});t.val.is;o.store.stats={get:{time:{},count:0},put:{time:{},count:0}};var u=0}})