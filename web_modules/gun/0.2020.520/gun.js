!function(){function t(n,e){return e?require(n):n.slice?t[o(n)]:function(e,i){n(e={exports:{}}),t[o(i)]=e.exports};function o(t){return t.split("/").slice(-1).toString().replace(".js","")}}if("undefined"!=typeof module)var n=module;t(function(t){var n={fn:{is:function(t){return!!t&&"function"==typeof t}}};n.bi={is:function(t){return t instanceof Boolean||"boolean"==typeof t}},n.num={is:function(t){return!e(t)&&(t-parseFloat(t)+1>=0||1/0===t||-1/0===t)}},n.text={is:function(t){return"string"==typeof t}},n.text.ify=function(t){return n.text.is(t)?t:"undefined"!=typeof JSON?JSON.stringify(t):t&&t.toString?t.toString():t},n.text.random=function(t,n){var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";t>0;)e+=n.charAt(Math.floor(Math.random()*n.length)),t--;return e},n.text.match=function(t,n){var e,o;return"string"==typeof t&&("string"==typeof n&&(n={"=":n}),t===(e=(n=n||{})["="]||n["*"]||n[">"]||n["<"])||o===n["="]&&(e=n["*"]||n[">"]||n["<"],t.slice(0,(e||"").length)===e||o===n["*"]&&(o!==n[">"]&&o!==n["<"]?t>=n[">"]&&t<=n["<"]:o!==n[">"]&&t>=n[">"]||o!==n["<"]&&t<=n["<"])))},n.text.hash=function(t,n){if("string"==typeof t){if(n=n||0,!t.length)return n;for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}},n.list={is:function(t){return t instanceof Array}},n.list.slit=Array.prototype.slice,n.list.sort=function(t){return function(n,e){return n&&e?(n=n[t])<(e=e[t])?-1:n>e?1:0:0}},n.list.map=function(t,n,e){return a(t,n,e)},n.list.index=1,n.obj={is:function(t){return!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},n.obj.put=function(t,n,e){return(t||{})[n]=e,t},n.obj.has=function(t,n){return t&&Object.prototype.hasOwnProperty.call(t,n)},n.obj.del=function(t,n){if(t)return t[n]=null,delete t[n],t},n.obj.as=function(t,n,e,o){return t[n]=t[n]||(o===e?{}:e)},n.obj.ify=function(t){if(i(t))return t;try{t=JSON.parse(t)}catch(n){t={}}return t},function(){var t;function e(n,e){r(this,e)&&t!==this[e]||(this[e]=n)}n.obj.to=function(t,n){return a(t,e,n=n||{}),n}}(),n.obj.copy=function(t){return t?JSON.parse(JSON.stringify(t)):t},function(){function t(t,n){var e=this.n;if(!e||!(n===e||i(e)&&r(e,n)))return void 0!==n||void 0}n.obj.empty=function(n,e){return!n||!a(n,t,{n:e})}}(),function(){function t(n,e){if(2===arguments.length)return t.r=t.r||{},void(t.r[n]=e);t.r=t.r||[],t.r.push(n)}var o,a=Object.keys;Object.keys=Object.keys||function(t){return o(t,function(t,n,e){e(n)})},n.obj.map=o=function(o,u,s){var f,c,l,p,h,d=0,g="function"==typeof u;if(t.r=f,a&&i(o)&&(p=a(o),h=!0),s=s||{},e(o)||p)for(c=(p||o).length;d<c;d++){var v=d+n.list.index;if(g){if((l=h?u.call(s,o[p[d]],p[d],t):u.call(s,o[d],v,t))!==f)return l}else if(u===o[h?p[d]:d])return p?p[d]:v}else for(d in o)if(g){if(r(o,d)&&(l=s?u.call(s,o[d],d,t):u(o[d],d,t))!==f)return l}else if(u===o[d])return d;return g?t.r:n.list.index?0:-1}}(),n.time={},n.time.is=function(t){return t?t instanceof Date:+(new Date).getTime()};n.fn.is;var e=n.list.is,o=n.obj,i=o.is,r=o.has,a=o.map;t.exports=n})(t,"./type"),t(function(t){t.exports=function t(n,e,o){if(!n)return{to:t};n=(this.tag||(this.tag={}))[n]||(this.tag[n]={tag:n,to:t._={next:function(t){var n;(n=this.to)&&n.next(t)}}});if("function"==typeof e){var i={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:e,the:n,on:this,as:o};return(i.back=n.last||n).to=i,n.last=i}return(n=n.to)&&void 0!==e&&n.next(e),n}})(t,"./onto"),t(function(t){var n="undefined"!=typeof setImmediate?setImmediate:setTimeout,e=[];t.exports=setTimeout.puff=function(t){e.length?e.push(t):(e=[t],n(function t(o){o=o||+new Date;for(var i,r=0;r<9&&(i=e[r++]);)i();if(console.STAT&&console.STAT(o,+new Date-o,"puff"),i&&!(+new Date-o))return t(o);(e=e.slice(r)).length&&n(t,0)},0))}})(t,"./puff"),t(function(t){if("undefined"==typeof JSON)throw new Error("JSON is not included in this browser. Please load it first: ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js");var n=JSON.stringify;t.exports=function(t,e,o,i,r){if(t<e)return{defer:!0};if(e<o)return{historical:!0};if(o<e)return{converge:!0,incoming:!0};if(e===o){if((i=n(i)||"")===(r=n(r)||""))return{state:!0};if(i<r)return{converge:!0,current:!0};if(r<i)return{converge:!0,incoming:!0}}return{err:"Invalid CRDT Data: "+i+" to "+r+" at "+e+" to "+o+"!"}}})(t,"./HAM"),t(function(n){var e=t("./type"),o={is:function(t){return void 0!==t&&(null===t||t!==1/0&&(!!(u(t)||r(t)||a(t))||(o.link.is(t)||!1)))}};o.link=o.rel={_:"#"},function(){function t(t,n){var e=this;return e.id?e.id=!1:n==i&&u(t)?void(e.id=t):e.id=!1}o.link.is=function(n){if(n&&n[i]&&!n._&&f(n)){var e={};if(l(n,t,e),e.id)return e.id}return!1}}(),o.link.ify=function(t){return c({},i,t)},e.obj.has._=".";var i=o.link._,r=e.bi.is,a=e.num.is,u=e.text.is,s=e.obj,f=s.is,c=s.put,l=s.map;n.exports=o})(t,"./val"),t(function(n){var e=t("./type"),o=t("./val"),i={_:"_",soul:function(t,n){return t&&t._&&t._[n||c]}};i.soul.ify=function(t,n){return n="string"==typeof n?{soul:n}:n||{},(t=t||{})._=t._||{},t._[c]=n.soul||t._[c]||f(),t},i.soul._=o.link._,function(){function t(t,n){if(n!==i._)return!o.is(t)||void(this.cb&&this.cb.call(this.as,t,n,this.n,this.s))}i.is=function(n,e,o){var r;return!!a(n)&&(!!(r=i.soul(n))&&!s(n,t,{as:o,cb:e,s:r,n:n}))}}(),function(){function t(t,n){var e,i=this.o;i.map?void 0===(e=i.map.call(this.as,t,""+n,i.node))?u(i.node,n):i.node&&(i.node[n]=e):o.is(t)&&(i.node[n]=t)}i.ify=function(n,e,o){return e?"string"==typeof e?e={soul:e}:"function"==typeof e&&(e={map:e}):e={},e.map&&(e.node=e.map.call(o,n,void 0,e.node||{})),(e.node=i.soul.ify(e.node||{},e))&&s(n,t,{o:e,as:o}),e.node}}();var r=e.obj,a=r.is,u=r.del,s=r.map,f=e.text.random,c=i.soul._;n.exports=i})(t,"./node"),t(function(n){var e=t("./type"),o=t("./node");function i(){var t;return t=+new Date,r<t?(a=0,r=t+i.drift):r=t+(a+=1)/u+i.drift}e.time.is;var r=-1/0,a=0,u=1e3,s="undefined"!=typeof performance&&(performance.timing&&performance),f=(s&&s.timing&&s.timing.navigationStart||(s=!1),i._=">");i.drift=0,i.is=function(t,n,e){var o=n&&t&&t[b]&&t[b][f]||e;if(o)return m(o=o[n])?o:-1/0},i.lex=function(){return i().toString(36).replace(".","")},i.ify=function(t,n,e,i,r){if(!t||!t[b]){if(!r)return;t=o.soul.ify(t,r)}var a=p(t[b],f);return c!==n&&n!==b&&(m(e)&&(a[n]=e),c!==i&&(t[n]=i)),t},i.to=function(t,n,e){var r=(t||{})[n];return d(r)&&(r=v(r)),i.ify(e,n,i.is(t,n),r,o.soul(t))},function(){function t(t,n){b!==n&&i.ify(this.o,n,this.s)}i.map=function(n,e,o){var r,a=d(a=n||e)?a:null;return n=k(n=n||e)?n:null,a&&!n?(e=m(e)?e:i(),a[b]=a[b]||{},g(a,t,{o:a,s:e}),a):(o=o||d(e)?e:r,e=m(e)?e:i(),function(i,a,u,s){if(!n)return t.call({o:u,s:e},i,a),i;n.call(o||this||{},i,a,u,s),h(u,a)&&r===u[a]||t.call({o:u,s:e},i,a)})}}();var c,l=e.obj,p=l.as,h=l.has,d=l.is,g=l.map,v=l.copy,m=e.num.is,k=e.fn.is,b=o._;n.exports=i})(t,"./state"),t(function(n){var e=t("./type"),o=t("./val"),i=t("./node"),r={};!function(){function t(t,e){if(!t||e!==i.soul(t)||!i.is(t,this.fn,this.as))return!0;this.cb&&(n.n=t,n.as=this.as,this.cb.call(n.as,t,e,n))}function n(t){t&&i.is(n.n,t,n.as)}r.is=function(n,e,o,i){return!(!n||!s(n)||l(n))&&!h(n,t,{cb:e,fn:o,as:i})}}(),function(){function t(t,e){var r;return(r=function(t,n){var e,o=t.seen,i=o.length;for(;i--;)if(e=o[i],n.obj===e.obj)return e;o.push(n)}(t,e))?r:(e.env=t,e.soul=u,i.ify(e.obj,n,e)&&(e.link=e.link||o.link.ify(i.soul(e.node)),e.obj!==t.shell&&(t.graph[o.link.is(e.link)]=e.node)),e)}function n(n,e,r){var u,s,p=this,h=p.env;if(i._===e&&c(n,o.link._))return r._;if(u=l(n,e,r,p,h)){if(e||(p.node=p.node||r||{},c(n,i._)&&i.soul(n)&&(p.node._=d(n._)),p.node=i.soul.ify(p.node,o.link.is(p.link)),p.link=p.link||o.link.ify(i.soul(p.node))),(s=h.map)&&(s.call(h.as||{},n,e,r,p),c(r,e))){if(n=r[e],a===n)return void f(r,e);if(!(u=l(n,e,r,p,h)))return}if(!e)return p.node;if(!0===u)return n;if((s=t(h,{obj:n,path:p.path.concat(e)})).node)return s.link}}function u(t){var n=this,e=o.link.is(n.link),r=n.env.graph;n.link=n.link||o.link.ify(t),n.link[o.link._]=t,n.node&&n.node[i._]&&(n.node[i._][o.link._]=t),c(r,e)&&(r[t]=r[e],f(r,e))}function l(t,n,i,r,a){var u;return!!o.is(t)||(s(t)?1:(u=a.invalid)?l(t=u.call(a.as||{},t,n,i),n,i,r,a):(a.err="Invalid value at '"+r.path.concat(n).join(".")+"'!",void(e.list.is(t)&&(a.err+=" Use `.set(item)` instead of an Array."))))}r.ify=function(n,e,i){var r={path:[],obj:n};return e?"string"==typeof e?e={soul:e}:"function"==typeof e&&(e.map=e):e={},"string"==typeof i&&(e.soul=e.soul||i,i=a),e.soul&&(r.link=o.link.ify(e.soul)),e.shell=(i||{}).shell,e.graph=e.graph||{},e.seen=e.seen||[],e.as=e.as||i,t(e,r),e.root=r.node,e.graph}}(),r.node=function(t){var n=i.soul(t);if(n)return p({},n,t)},function(){function t(t,n){var e,a;if(i._!==n)(e=o.link.is(t))?(a=this.opt.seen[e])?this.obj[n]=a:this.obj[n]=this.opt.seen[e]=r.to(this.graph,e,this.opt):this.obj[n]=t;else{if(l(t,o.link._))return;this.obj[n]=d(t)}}r.to=function(n,e,o){if(n){var i={};return o=o||{seen:{}},h(n[e],t,{obj:i,graph:n,opt:o}),i}}}();e.fn.is;var a,u=e.obj,s=u.is,f=u.del,c=u.has,l=u.empty,p=u.put,h=u.map,d=u.copy;n.exports=r})(t,"./graph"),t(function(n){t("./onto"),n.exports=function(t,n){if(this.on){if("function"!=typeof t){if(!t||!n)return;var e=t["#"]||t,o=(this.tag||"")[e];if(!o)return;return o=this.on(e,n),clearTimeout(o.err),!0}e=n&&n["#"]||Math.random().toString(36).slice(2);if(!t)return e;var i=this.on(e,t,n);return i.err=i.err||setTimeout(function(){i.next({err:"Error: No ACK yet.",lack:!0}),i.off()},(this.opt||{}).lack||9e3),e}}})(t,"./ask"),t(function(n){var e=t("./type");n.exports=function(t){var n={s:{}},o=n.s;t=t||{max:1e3,age:27e3},n.check=function(t){return!!o[t]&&i(t)};var i=n.track=function(e){var i=o[e]||(o[e]={});return i.was=+new Date,n.to||(n.to=setTimeout(n.drop,t.age+9)),i};return n.drop=function(i){var r=+new Date;e.obj.map(o,function(n,e){n&&(i||t.age)>r-n.was||delete o[e]}),n.to=null,console.STAT&&(i=+new Date-r)>9&&console.STAT(r,i,"dup drop")},n}})(t,"./dup"),t(function(e){function o(t){return t instanceof o?(this._={$:this}).$:this instanceof o?o.create(this._={$:this,opt:t}):new o(t)}o.is=function(t){return t instanceof o||t&&t._&&t===t._.$||!1},o.version=.202,o.chain=o.prototype,o.chain.toJSON=function(){};var i=t("./type");i.obj.to(i,o),o.HAM=t("./HAM"),o.val=t("./val"),o.node=t("./node"),o.state=t("./state"),o.graph=t("./graph"),o.on=t("./onto"),o.ask=t("./ask"),o.dup=t("./dup"),o.puff=t("./puff"),function(){function t(e){if(e)if(e.out!==t){var i,r=this.as,a=r.at||r,u=a.$,s=a.dup,f=e.DBG;(i=e["#"])||(i=e["#"]=c(9)),s.check(i)||(s.track(i),i=e._,e._="function"==typeof i?i:function(){},e.$&&e.$===(e.$._||"").$||(e.$=u),a.ask(e["@"],e)||(f&&(f.u=+new Date),e.get&&o.on._get(e,u),!e.put)?(f&&(f.uc=+new Date),this.to.next(e),f&&(f.ua=+new Date),e.out=t,a.on("out",e),f&&(f.ue=+new Date)):n(e))}else this.to.next(e)}function n(t){if(t){var n,i,f=t._||"",c=f.root=((f.$=t.$||"")._||"").root,l=t.put,p=t["#"],h=f.DBG=t.DBG;if(l["#"]&&l["."])c.on("put",t);else{f.out=t,f.lot={s:0,more:1};var d=+new Date;for(var g in h&&(h.p=d),l){var v,m=l[g];if(!m){n=u+s(g)+"no node.";break}if(!(i=m._)){n=u+s(g)+"no meta.";break}if(g!==i[k]){n=u+s(g)+"soul not same.";break}if(!(v=i[x])){n=u+s(g)+"no state.";break}for(var b in m)if(y!==b){var w=m[b],$=v[b];if(r===$){n=u+s(b)+"on"+s(g)+"no state.";break}if(!_(w)){n=u+s(b)+"on"+s(g)+"bad "+typeof w+s(w);break}e(w,b,g,$,t)}if(n)break}h&&(h.pe=+new Date),console.STAT&&(console.STAT(d,+new Date-d,"mix"),console.STAT(d,f.lot.s,"mix #")),(f.err=n)?c.on("in",{"@":p,err:o.log(n)}):(--f.lot.more||a(f),f.stun||t["@"]||c.on("in",{"@":p,ok:-1}))}}}function e(t,n,o,i,r){var a,u=r._||"",s=u.root,c=s.graph[o]||w,h=m(c,n,1),d=c[n],g=p(),v=f(g,i,h,t,d);if(!v.incoming){if(v.defer){var k=i-g;return setTimeout(function(){e(t,n,o,i,r)},k>l?l:k),u.to||s.on("in",{"@":r["#"],err:k}),u.to=1,k}if(!u.miss)return}(a=u.lot||"").s++,a.more++,(u.stun||(u.stun={}))[o+n]=1;var b=u.DBG;b&&(b.ph=b.ph||+new Date),s.on("put",{"#":r["#"],"@":r["@"],put:{"#":o,".":n,":":t,">":i},_:u})}function i(t){var n;(n=(t._||"").DBG)&&(n.pa=+new Date,n.pm=n.pm||+new Date);var e,o=this.as.graph,i=t._,u=t.put,s=u["#"],f=u["."],c=u[":"],l=u[">"];t["#"];o[s]=v(o[s],f,l,c,s),function(t,n,e,o,i){var r,a,u=t.root;if((u.opt||"").super&&u.$.get(n),!(u&&(a=u.next)&&(a=a[n])&&a.$))return;(r=t.put||(t.put={}))[n]=v(r[n],e,i,o,n),a.put=v(a.put,e,i,o,n)}(i,s,f,r!==(e=u["="])?e:c,l),(e=i.out)&&(e=e.put)&&(e[s]=v(e[s],f,l,c,s)),--i.lot.more||a(i),this.to.next(t)}function a(n){if(!n.err){var e,o={},i=((n.$||"")._||"").root,r=(i||"").next||"",a=n.put,u=+new Date;for(var s in a){var f=a[s];(e=r[s])&&e.$&&(i.stop=o,e.on("in",{$:e.$,get:s,put:f}),i.stop=null)}console.STAT&&console.STAT(u,+new Date-u,"fire"),n.DBG&&(n.DBG.f=+new Date),(e=n.out)&&(e.out=t,i.on("out",e))}}o.create=function(n){n.root=n.root||n,n.graph=n.graph||{},n.on=n.on||o.on,n.ask=n.ask||o.ask,n.dup=n.dup||o.dup();var e=n.$.opt(n.opt);return n.once||(n.on("in",t,n),n.on("out",t,n),n.on("put",i,n),o.on("create",n),n.on("create",n)),n.once=1,e},o.on.put=n;var u="Error: Invalid graph!",s=function(t){return" '"+(""+t).slice(0,9)+"...' "},f=o.HAM,l=2147483647,p=o.state}(),function(){function t(t,n,e,i){var r=this,a=o.state.is(e,n);if(!a)return r.err="Error: No state on '"+n+"' in node '"+i+"'!";var u=r.graph[i]||w,s=o.state.is(u,n,!0),f=u[n],c=o.HAM(r.machine,a,s,t,f);c.incoming?(r.put[i]=o.state.to(e,n,r.put[i]),(r.diff||(r.diff={}))[i]=o.state.to(e,n,r.diff[i]),r.souls[i]=!0):c.defer&&(r.defer=a<(r.defer||1/0)?a:r.defer)}function n(t,n){var o=this,r=o.$._,u=(r.next||w)[n];if(!u){if(!(r.opt||w).super)return void(o.souls[n]=!1);u=o.$.get(n)._}var s=o.map[n]={put:t,get:n,$:u.$},f={ctx:o,msg:s};o.async=!!r.tag.node,o.ack&&(s["@"]=o.ack),g(t,e,f),o.async&&(o.and||r.on("node",function(t){this.to.next(t),t===o.map[t.get]&&(o.souls[t.get]=!1,g(t.put,i,t),g(o.souls,function(t){if(t)return t})||o.c||(o.c=1,this.off(),g(o.map,a,o)))}),o.and=!0,r.on("node",s))}function e(t,n){var e=this.ctx,i=e.graph,r=this.msg,a=r.get,u=r.put,s=r.$._;i[a]=o.state.to(u,n,i[a]),e.async||(s.put=o.state.to(u,n,s.put))}function i(t,n){var e=this.put,i=this.$._;i.put=o.state.to(e,n,i.put)}function a(t,n){t.$&&(this.cat.stop=this.stop,t.$._.on("in",t),this.cat.stop=null)}function u(t,n){if(t!==this.graph[n])return!0}o.on._put=function(e,i){var s=i._,f={$:i,graph:s.graph,put:{},map:{},souls:{},machine:o.state(),ack:e["@"],cat:s,stop:{}};if(o.obj.map(e.put,u,f)){if(o.graph.is(e.put,null,t,f)||(f.err="Error: Invalid graph!"),f.err)return s.on("in",{"@":e["#"],err:o.log(f.err)});if(g(f.put,n,f),f.async||g(f.map,a,f),r!==f.defer){var c=f.defer-f.machine;setTimeout(function(){o.on._put(e,i)},c>MD?MD:c)}f.diff&&s.on("put",d(e,{put:f.diff}))}},o.on._get=function(t,n){var e=n._,i=t.get,r=i[k],a=e.graph[r],u=i[b],s=(e.next||(e.next={}))[r],f=(t._||"").DBG=t.DBG;if(f&&(f.g=+new Date),!a)return e.on("get",t);if(u){if("string"!=typeof u||!h(a,u))return e.on("get",t);a=o.state.to(a,u)}else a=o.window?o.obj.copy(a):a;a=o.graph.node(a),(s||w).ack;var c=function(){};c.ram=c.faith=!0,c.$=t.$,f&&(f.ga=+new Date),e.on("in",{"@":t["#"],put:a,ram:1,$:n,_:c}),f&&(f.gm=+new Date),e.on("get",t),f&&(f.gd=+new Date)}}(),o.chain.opt=function(t){t=t||{};var n=this._,e=t.peers||t;return p(t)||(t={}),p(n.opt)||(n.opt=t),f(e)&&(e=[e]),u(e)&&(e=g(e,function(t,n,e){(n={}).id=n.url=t,e(t,n)}),p(n.opt.peers)||(n.opt.peers={}),n.opt.peers=d(e,n.opt.peers)),n.opt.peers=n.opt.peers||{},g(t,function t(n,e){!h(this,e)||s.is(n)||l.empty(n)?this[e]=n:n&&n.constructor!==Object&&!u(n)||g(n,t,this[e])},n.opt),o.on("opt",n),o.obj.native(),this},o.obj.native=function(){var t=Object.prototype;for(var n in t)console.log("Native Object.prototype polluted, reverting",n),delete t[n]};var r,a,u=o.list.is,s=o.text,f=s.is,c=s.random,l=o.obj,p=(l.empty,l.is),h=l.has,d=l.to,g=l.map,v=(l.copy,o.state.lex,o.state.ify),m=o.state.is,k=o.val.link._,b=".",y=o.node._,_=o.val.is,x=(o.val.link.is,o.state._),w={};o.log=function(){return!o.log.off&&a.log.apply(a,arguments),[].slice.call(arguments).join(" ")},o.log.once=function(t,n,e){return(e=o.log.once)[t]=e[t]||0,e[t]++||o.log(n)},"undefined"!=typeof window&&((window.GUN=window.Gun=o).window=window);try{void 0!==n&&(n.exports=o)}catch(t){}e.exports=o,(o.window||"").console=(o.window||"").console||{log:function(){}},(a=console).only=function(t,n){return a.only.i&&t===a.only.i&&a.only.i++&&(a.log.apply(a,arguments)||n)},o.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(t,"./root"),t(function(n){var e=t("./root");e.chain.back=function(t,n){if(-1===(t=t||1)||1/0===t)return this._.root.$;if(1===t)return(this._.back||this._).$;var r=this._;if("string"==typeof t&&(t=t.split(".")),t instanceof Array){for(var a=0,u=t.length,s=r;a<u;a++)s=(s||i)[t[a]];return o!==s?n?this:s:(s=r.back)?s.$.back(t,n):void 0}if("function"==typeof t){var f;for(s={back:r};(s=s.back)&&o===(f=t(s,n)););return f}return e.num.is(t)?(r.back||r).$.back(t-1):this};var o,i={}})(t,"./back"),t(function(n){var e=t("./root");function o(t){var n,o,i=this.as,r=i.back,a=i.root;if(t.$||(t.$=i.$),this.to.next(t),n=t.get){if(i.lex&&(t.get=v(i.lex,t.get)),n["#"]||i.soul){if(n["#"]=n["#"]||i.soul,t["#"]||(t["#"]=k(9)),r=a.$.get(n["#"])._,n=n["."]){if(d(r.put,n)){if((o=(u=r.$.get(n)._).ack)||(u.ack=-1),r.on("in",{$:r.$,put:e.state.to(r.put,n),get:r.get}),o)return}else if("string"!=typeof n){var u={},s=(r.put||{})._;if(e.obj.map(r.put,function(t,o){e.text.match(o,n)&&(u[o]=t)}),e.obj.empty(u)||(u._=s,r.on("in",{$:r.$,put:u,get:r.get})),o=i.lex){if(o=o._||(o._=function(){}),r.ack<o.ask&&(o.ask=r.ack),o.ask)return;o.ask=1}}}else{if((o=r.ack)||(r.ack=-1),d(r,"put")&&r.on("in",r),o&&l!==r.put)return;t.$=r.$}return a.ask(c,t),a.on("in",t)}if(a.now&&(a.now[i.id]=a.now[i.id]||!0,i.pass={}),n["."])return i.get?(t={get:{".":i.get},$:i.$},r.ask||(r.ask={}),r.ask[i.get]=t.$._,r.on("out",t)):(t={get:{},$:i.$},r.on("out",t));if(i.ack=i.ack||-1,i.get)return t.$=i.$,n["."]=i.get,(r.ask||(r.ask={}))[i.get]=t.$._,r.on("out",t)}return r.on("out",t)}function i(t){var n,o,i=this,u=i.as,c=u.root,h=(t.$||p)._||p,k=t.put;if(u.get&&t.get!==u.get&&(t=v(t,{get:u.get})),u.has&&h!==u&&(t=v(t,{$:u.$}),h.ack&&(u.ack=h.ack)),l===k){if(o=h.put,i.to.next(t),u.soul)return;if(l===o&&l!==h.put)return;return a(u,t,i),u.has&&f(u,t),g(h.echo,u.id),void g(u.map,h.id)}if(u.soul)return i.to.next(t),a(u,t,i),void(u.next&&m(k,s,{msg:t,cat:u}));if(!(n=e.val.link.is(k)))return e.val.is(k)?(u.has||u.soul?f(u,t):(h.has||h.soul)&&((h.echo||(h.echo={}))[u.id]=h.echo[h.id]||u,(u.map||(u.map={}))[h.id]=u.map[h.id]||{at:h}),i.to.next(t),void a(u,t,i)):(u.has&&h!==u&&d(h,"put")&&(u.put=h.put),(n=e.node.soul(k))&&h.has&&(h.put=u.root.$.get(n)._.put),o=(c.stop||{})[h.id],i.to.next(t),r(u,t,h,n),a(u,t,i),void(u.next&&m(k,s,{msg:t,cat:u})));c.stop;(o=(o=c.stop||{})[h.id]||(o[h.id]={})).is=o.is||h.put,o[u.id]=h.put||!0,i.to.next(t),r(u,t,h,n),a(u,t,i)}function r(t,n,o,i){if(i&&b!==t.get){var a=t.root.$.get(i)._;t.has?o=a:o.has&&r(o,n,o,i),o!==t&&(o.$||(o={}),(o.echo||(o.echo={}))[t.id]=o.echo[t.id]||t,t.has&&!(t.map||p)[o.id]&&f(t,n),(i!==(a=o.id?(t.map||(t.map={}))[o.id]=t.map[o.id]||{at:o}:{}).link||a.pass||t.pass)&&(t.pass&&(e.obj.map(t.map,function(t){t.pass=!0}),g(t,"pass")),a.pass&&g(a,"pass"),t.has&&(t.link=i),function(t,n){var o=t.root.$.get(n)._,i=t.lex;if((t.ack||i)&&((i=i||{})["#"]=n,o.on("out",{get:i}),!t.ask))return;o=t.ask,e.obj.del(t,"ask"),m(o||t.next,function(t,e){var o=t.lex||{};o["#"]=n,o["."]=o["."]||e,t.on("out",{get:o})}),e.obj.del(t,"ask")}(t,a.link=i)))}}function a(t,n,e){t.echo&&m(t.echo,u,n)}function u(t){t&&t.on&&t.on("in",this)}function s(t,n){var o,i,r,a=this.cat.next||p,u=this.msg;(b!==n||a[n])&&(i=a[n])&&(i.has?(l!==i.put&&e.val.link.is(t)||(i.put=t),o=i.$):(r=u.$)&&(r=(o=u.$.get(n))._,l!==r.put&&e.val.link.is(t)||(r.put=t)),i.on("in",{put:t,get:n,$:o,via:u}))}function f(t,n){if(t.has||t.soul){var o=t.map;t.root;t.map=null,t.has&&(t.dub&&t.root.stop&&(t.dub=null),t.link=null),(t.pass||n["@"]||null!==o)&&(l===o&&e.val.link.is(t.put)||(m(o,function(n){(n=n.at)&&g(n.echo,t.id)}),o=t.put,m(t.next,function(n,e){if(l===o&&l!==t.put)return!0;n.put=l,n.ack&&(n.ack=-1),n.on("in",{get:e,$:n.$,put:l})})))}}function c(t,n){var o=this.as,i=o.get||"",r=o.$._,a=(t.put||"")[i["#"]];if(r.ack&&(r.ack=r.ack+1||1),t.put&&("string"!=typeof i["."]||d(a,r.get)))b!=i["."]?(r.$===(t._||"").$&&(t._.miss=r.put===l),e.on.put(t)):r.on("in",{get:r.get,put:e.val.link.ify(i["#"]),$:r.$,"@":t["@"]});else{if(r.put!==l)return;r.on("in",{get:r.get,put:r.put=l,$:r.$,"@":t["@"]})}}e.chain.chain=function(t){var n,r=this._,a=new(t||this).constructor(this),u=a._;return u.root=n=r.root,u.id=++n.once,u.back=this._,u.on=e.on,u.on("in",i,u),u.on("out",o,u),a};var l,p={},h=e.obj,d=h.has,g=(h.put,h.del),v=h.to,m=h.map,k=e.text.random,b=(e.val.link._,e.node._)})(t,"./chain"),t(function(n){var e=t("./root");function o(t){var n,o=this,i=o.as,a=i.at.root,s=(t.$||{})._||{},c=t.put||s.put;if((n=a.now)&&o!==n[i.now])return o.to.next(t);if(o.seen&&s.id&&o.seen[s.id])return o.to.next(t);if((n=c)&&n[f._]&&(n=f.is(n))&&(n=(t.$$=s.root.$.get(n))._,r!==n.put&&(t=u(t,{put:c=n.put}))),(n=a.mum)&&s.id){var l=s.id+(o.id||(o.id=e.text.random(9)));if(n[l])return;r===c||f.is(c)||(n[l]=!0)}i.use(t,o),o.stun?o.stun=null:o.to.next(t)}function i(t){var n=this.on;if(!t||n.soul||n.has)return this.off();if(t=(t=(t=t.$||t)._||t).id){var e;n.map;if((e=this.seen||(this.seen={}))[t])return!0;e[t]=!0}}e.chain.get=function(t,n,u){var p;if("string"!=typeof t){if("function"==typeof t){if(!0===n)return function(t,n,e,o){var i,a=t._,u=0;if(i=a.soul||a.link||a.dub)return n(i,o,a);if(a.jam)return a.jam.push([n,o]);a.jam=[[n,o]],t.get(function(t,n){if(!(r===t.put&&!a.root.opt.super&&(i=Object.keys(a.root.opt.peers).length)&&++u<=i)){n.rid(t);var e,o=(o=t.$)&&o._||{},s=0;for(i=a.jam,delete a.jam;e=i[s++];){var l=e[0];e=e[1],l&&l(o.link||o.soul||f.is(t.put)||c(t.put)||o.dub,e,t,n)}}},{out:{get:{".":!0}}})}(this,t,0,u),this;var h,d=(p=this)._,g=d.root,v=g.now;(u=n||{}).at=d,u.use=t,u.out=u.out||{},u.out.get=u.out.get||{},(h=d.on("in",o,u)).rid=i,(g.now={$:1})[u.now=d.id]=h;var m=g.mum;return g.mum={},d.on("out",u.out),g.mum=m,g.now=v,p}return s(t)?this.get(""+t,n,u):(v=f.is(t))?this.get(v,n,u):a.is(t)?(p=this,(v=((v=t["#"])||l)["="]||v)&&(p=p.get(v)),p._.lex=t,p):((u=this.chain())._.err={err:e.log("Invalid get request!",t)},n&&n.call(u,u._.err),u)}return(p=(this._.next||l)[t])||(p=function(t,n){var e=n._,o=e.next,i=n.chain()._;o||(o=e.next={});o[i.get=t]=i,n===e.root.$?i.soul=t:(e.soul||e.has)&&(i.has=t);return i}(t,this)),p=p.$,(v=this._.stun)&&(p._.stun=p._.stun||v),n&&"function"==typeof n&&p.get(n,u),p};var r,a=e.obj,u=(a.map,a.has,e.obj.to),s=e.num.is,f=e.val.link,c=e.node.soul,l=(e.node._,{})})(t,"./get"),t(function(n){var e=t("./root");function o(t){t&&t()}function i(){var t=this;t.graph&&h(t.stun)&&(t.res=t.res||function(t){t&&t()},t.res(function(){delete t.via._.stun;var n=t.$.back(-1)._,o=n.ask(function(o){n.root.on("ack",o),o.err&&e.log(o),++i>(t.acks||0)&&this.off(),t.ack&&t.ack(o,this)},t.opt),i=0,r=n.root.now;c.del(n.root,"now");var a=n.root.mum;n.root.mum={},t.ref._.on("out",{$:t.ref,put:t.out=t.env.graph,opt:t.opt,"#":o}),n.root.mum=a?c.to(a,n.root.mum):a,n.root.now=r,t.via._.on("res",{}),delete t.via._.tag.res},t),t.res&&t.res())}function r(t,n,o,i){var r=this,u=e.is(t);!n&&i.path.length&&(r.res||v)(function(){for(var n=i.path,o=r.ref,s=(r.opt,0),f=n.length;s<f;s++)o=o.get(n[s]);u&&(o=t);var c=o._.dub;if(c||(c=e.node.soul(i.obj)))return o.back(-1).get(c),void i.soul(c);(r.stun=r.stun||{})[n]=1,o.get(a,!0,{as:{at:i,as:r,p:n,ref:o}})},{as:r,at:i})}e.chain.put=function(t,n,a){var u,f=this,c=f._,h=c.root.$;h._;return(a=a||{}).data=t,a.via=a.$=a.via||a.$||f,"string"==typeof n?a.soul=n:a.ack=a.ack||n,c.soul&&(a.soul=c.soul),a.soul||h===f?l(a.data)?(a.soul=a.soul||(a.not=e.node.soul(a.data)||(a.via.back("opt.uuid")||e.text.random)()),a.via._.stun={},a.soul?(a.$=h.get(a.soul),a.ref=a.$,function(t){t.batch=i;var n=t.opt||{},o=t.env=e.state.map(r,n.state);if(o.soul=t.soul,t.graph=e.graph.ify(t.data,o,t),o.err)return(t.ack||g).call(t,t.out={err:e.log(o.err)}),void(t.res&&t.res());t.batch()}(a),f):(a.via.back("opt.uuid")(function(t,n){if(t)return e.log(t);(a.ref||a.$).put(a.data,a.soul=n,a)}),f)):((a.ack||g).call(a,a.out={err:e.log("Data saved to the root level of the graph must be a node (an object), not a",typeof a.data,'of "'+a.data+'"!')}),a.res&&a.res(),f):(a.via._.stun={},e.is(t)?(t.get(function(t,o,i){if(!t)return delete a.via._.stun,e.log("The reference you are saving is a",typeof i.put,'"'+i.put+'", not a node (object)!');f.put(e.val.link.ify(t),n,a)},!0),f):(c.has&&(u=e.val.link.is(t))&&(c.dub=u),a.ref=a.ref||h._===(u=c.back)?f:u.$,a.ref._.soul&&e.val.is(a.data)&&c.get?(a.data=p({},c.get,a.data),a.ref.put(a.data,a.soul,a),f):(a.ref.get(s,!0,{as:a}),a.out||(a.res=a.res||o,a.$._.stun=a.ref._.stun),f)))};String.fromCharCode(31);function a(t,n,o,i){(n=n.as).p;var r,a=n.ref,s=n.at,f=[];n=n.as,a.back(function(t){if(r=t.soul||t.link||t.dub)return r;f.push(t.has||t.get)}),f=[r||n.soul].concat(f.reverse());var c=((o||{}).$||{})._||{};t=c.dub=c.dub||t||e.node.soul(s.obj)||e.node.soul(o.put||c.put)||e.val.link.is(o.put||c.put)||f.join("/"),i&&(i.stun=!0),t?u(c,c.dub=t,s,n):n.via.back("opt.uuid")(function(t,o){if(t)return e.log(t);u(c,c.dub=c.dub||o,s,n)})}function u(t,n,e,o){t.$.back(-1).get(n),e.soul(n),delete o.stun[e.path],o.batch()}function s(t,n,o,i){if(n=n.as,o.$&&o.$._)if(o.err)e.log("Please report this as an issue! Put.any.err");else{var r,a=o.$._,u=a.put,s=n.opt||{};if(!(r=n.ref)||!r._.now){if(i&&(i.stun=!0),n.ref!==n.$){if(!(r=n.$._.get||a.get))return delete n.via._.stun,void e.log("Please report this as an issue! Put.no.get");n.data=p({},r,n.data),r=null}if(f===u){if(!a.get)return void delete n.via._.stun;t||(r=a.$.back(function(t){if(t.link||t.soul)return t.link||t.soul;n.data=p({},t.get,n.data)}),n.not=!0),a=(r=r||a.soul||a.link||a.dub)?a.root.$.get(r)._:a,n.soul=r,u=n.data}n.not||(n.soul=n.soul||t)||(n.path&&l(n.data)?n.soul=(s.uuid||n.via.back("opt.uuid")||e.text.random)():(m==a.get&&(n.soul=(a.put||d)["#"]||a.dub),n.soul=n.soul||a.soul||a.link||(s.uuid||n.via.back("opt.uuid")||e.text.random)()),n.soul)?n.ref.put(n.data,n.soul,n):n.via.back("opt.uuid")(function(t,o){if(t)return delete n.via._.stun,e.log(t);n.ref.put(n.data,n.soul=o,n)})}}}var f,c=e.obj,l=c.is,p=c.put,h=(c.map,c.empty),d={},g=function(){},v=function(t,n){t.call(n||d)},m=e.node._})(t,"./put"),t(function(n){var e=t("./root");t("./chain"),t("./back"),t("./put"),t("./get"),n.exports=e})(t,"./index"),t(function(n){var e=t("./index");function o(t,n){var e,o=t.$,i=((o||{})._||{}).put||t.put;this.at;if(r!==i){if(e=t.$$){if(e=t.$$._,r===e.put)return;i=e.put}this.change&&(i=t.put),this.as?this.ok.call(this.as,t,n):this.ok.call(o,i,t.get,t,n)}}function i(t,n,o){if(t.$){var a,u,s=this.as,c=(s.at,t.$),l=c._,p=l.put||t.put;(u=t.$$)&&(a=u=t.$$._,r!==a.put&&(p=a.put)),(u=n.wait)&&(u=u[l.id])&&clearTimeout(u),n.ack=(n.ack||0)+1,!o&&r===p&&!l.root.opt.super&&n.ack<=(s.acks||Object.keys(l.root.opt.peers).length)||(!o&&(r===p||l.soul||l.link||a&&!(0<a.ack))||r===p&&!l.root.opt.super&&(u=Object.keys(l.root.opt.peers).length)&&!o&&(a||l).ack<u?u=(n.wait={})[l.id]=setTimeout(function(){i.call({as:s},t,n,u||1)},s.wait||99):(a&&r===a.put&&(u=f.is(p))&&(p=e.node.ify({},u)),n.rid?n.rid(t):n.off(),s.ok.call(c||s.$,p,t.get)))}else n.off()}e.chain.on=function(t,n,e,i){var r,a=this._;if("string"==typeof t)return n?(r=a.on(t,n,e||a,i),e&&e.$&&(e.subs||(e.subs=[])).push(r),this):a.on(t);var u=n;return(u=!0===u?{change:!0}:u||{}).at=a,u.ok=t,this.get(o,u),this},e.chain.val=function(t,n){return e.log.once("onceval","Future Breaking API Change: .val -> .once, apologies unexpected."),this.once(t,n)},e.chain.once=function(t,n){var o=this,a=o._,u=a.put;if(0<a.ack&&r!==u)return(t||c).call(o,u,a.get),o;if(!t){e.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it.");var s=o.chain();return s._.nix=o.once(function(){s._.on("in",o._)}),s}return(n=n||{}).ok=t,n.at=a,n.out={"#":e.text.random(9)},o.get(i,{as:n}),n.async=!0,o},e.chain.off=function(){var t,n=this._,e=n.back;if(e)return n.ack=0,(t=e.next)&&t[n.get]&&s(t,n.get),(t=e.ask)&&s(t,n.get),(t=e.put)&&s(t,n.get),(t=n.soul)&&s(e.root.graph,t),(t=n.map)&&u(t,function(t){t.link&&e.root.$.get(t.link).off()}),(t=n.next)&&u(t,function(t){t.$.off()}),n.on("off",{}),this};var r,a=e.obj,u=a.map,s=(a.has,a.del),f=(a.to,e.val.link),c=function(){}})(t,"./on"),t(function(n){var e=t("./index");function o(t){if(!t.put||e.val.is(t.put))return this.to.next(t);this.as.nix&&this.off(),r(t.put,i,{at:this.as,msg:t}),this.to.next(t)}function i(t,n){if(u!==n){var o=this.msg.$,i=o._,r=this.at,a=i.lex;a&&!e.text.match(n,a["."]||a["#"]||a)||(((a=o.get(n)._).echo||(a.echo={}))[r.id]=a.echo[r.id]||r)}}e.chain.map=function(t,n,i){var r,u=this._;return t?(e.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),r=this.chain(),this.map().on(function(n,o,i,u){var s=(t||a).call(this,n,o,i,u);if(void 0!==s)return n===s?r._.on("in",i):e.is(s)?r._.on("in",s._):void r._.on("in",{get:o,put:s})}),r):(r=u.each)?r:(u.each=r=this.chain(),r._.nix=this.back("nix"),this.on("in",o,r._),r)};var r=e.obj.map,a=function(){},u=e.node._})(t,"./map"),t(function(n){var e=t("./index");function o(){return e.state.lex()+e.text.random(7)}e.chain.set=function(t,n,i){var r,a=this;return n=n||function(){},(i=i||{}).item=i.item||t,(r=e.node.soul(t))&&(t=e.obj.put({},r,e.val.link.ify(r))),e.is(t)?(t.get(function(o,r,u){if(o||!t._.stun)return o?void a.put(e.obj.put({},o,e.val.link.ify(o)),n,i):n.call(a,{err:e.log('Only a node can be linked! Not "'+u.put+'"!')});t._.on("res",function(){this.off(),a.set(t,n,i)})},!0),t):(e.obj.is(t)&&(r=r||e.node.soul(t)||o()),a.get(r||o()).put(t,n,i))}})(t,"./set"),t(function(t){if("undefined"!=typeof Gun){var n;try{n=(Gun.window||function(){}).localStorage}catch(t){}n||(Gun.log("Warning: No localStorage exists to persist data to!"),n={setItem:function(t,n){this[t]=n},removeItem:function(t){delete this[t]},getItem:function(t){return this[t]}}),Gun.on("create",function(t){var e=this.to,o=t.opt;if(t.once)return e.next(t);if(!1===o.localStorage)return e.next(t);o.prefix=o.file||"gun/";var i,r,a=Gun.obj.ify(n.getItem("gap/"+o.prefix))||{},u=Gun.obj.empty;if(!u(a)){var s=Gun.obj.ify(n.getItem(o.prefix))||{},f={};Gun.obj.map(a,function(t,n){Gun.obj.map(t,function(t,e){f[n]=Gun.state.to(s[n],e,f[n])})}),setTimeout(function(){t.on("out",{put:f,"#":t.ask(c)})},1)}function c(t){if(!t.err&&t.ok){var n=t["@"];setTimeout(function(){Gun.obj.map(a,function(t,e){Gun.obj.map(t,function(e,o){n===e&&delete t[o]}),u(t)&&delete a[e]}),p()},o.wait||1)}}t.on("out",function(t){t.lS||(Gun.is(t.$)&&t.put&&!t["@"]&&(i=t["#"],Gun.graph.is(t.put,null,l),r||(r=setTimeout(p,o.wait||1))),this.to.next(t))}),t.on("ack",c),e.next(t);var l=function(t,n,e,o){(a[o]||(a[o]={}))[n]=i},p=function(){clearTimeout(r),r=!1;try{n.setItem("gap/"+o.prefix,JSON.stringify(a))}catch(t){Gun.log(err=t||"localStorage failure")}}}),Gun.on("create",function(t){this.to.next(t);var e=t.opt;if(!t.once&&!1!==e.localStorage){e.prefix=e.file||"gun/";t.graph;var o,i={},r=0,a=Gun.obj.ify(n.getItem(e.prefix))||{};t.on("localStorage",a),t.on("put",function(t){this.to.next(t);var n,s=t.put,f=s["#"],c=s["."],l=s[":"],p=s[">"];if(a[f]=Gun.state.ify(a[f],c,p,l,f),t["@"]||((i[t["#"]]=n=(t._||"").lot||{}).lS=(n.lS||0)+1),(r+=1)>=(e.batch||1e3))return u();o||(o=setTimeout(u,e.wait||1))}),t.on("get",function(n){this.to.next(n);var e,o,i,r=n.get;function u(){if(r&&(e=r["#"])){var u=r["."];(o=a[e]||i)&&u&&(o=Gun.state.to(o,u)),t.on("in",{"@":n["#"],put:Gun.graph.node(o),lS:1})}}Gun.debug?setTimeout(u,1):u()});var u=function(s){var f;r=0,clearTimeout(o),o=!1;var c=i;i={},s&&(a=s);try{n.setItem(e.prefix,JSON.stringify(a))}catch(n){Gun.log(f=(n||"localStorage failure")+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),t.on("localStorage:error",{err:f,file:e.prefix,flush:a,retry:u})}(f||Gun.obj.empty(e.peers))&&Gun.obj.map(c,function(n,e){if(n){if(n.more)return void(i[e]=n);n.s!==n.lS&&(f="localStorage batch not same.")}t.on("in",{"@":e,err:f,ok:0})})}}})}})(t,"./adapters/localStorage"),t(function(n){var e=t("../type");!function(){var t=JSON.stringify;function n(t,n){var i;if(!(n instanceof Object))return n;var r=+new Date;return e.obj.map(Object.keys(n).sort(),o,{to:i={},on:n}),console.STAT&&console.STAT(r,+new Date-r,"sort"),i}function o(t){this.to[t]=this.on[t]}e.obj.hash=function(o,i){if(i||void 0!==(o=t(o,n)))return e.text.hash(i||o||"")},e.obj.hash.sort=n}();var o=e.obj.is;e.obj.map;try{n.exports=function(t){var n=function(){},i=t.opt||{};i.log=i.log||console.log,i.gap=i.gap||i.wait||0,i.pack=i.pack||.3*(i.memory?1e3*i.memory*1e3:1399e6),i.puff=i.puff||9;var r=setTimeout.puff||setTimeout,a=t.dup,u=a.check,s=a.track,f=n.hear=function(a,l){if(a){if(i.pack<=a.length)return n.say({dam:"!",err:"Message too big!"},l);var p,h,d,g=a[0];if(n===this&&(f.d+=a.length||0,++f.c),"["!==g){if("{"===g||(a["#"]||o(a))&&(p=a)){try{p=p||JSON.parse(a)}catch(t){return i.log("DAM JSON parse error",t)}if(!p)return;if(p.DBG&&(p.DBG=d={DBG:p.DBG}),d&&(d.hp=+new Date),(h=p["#"])||(h=p["#"]=e.text.random(9)),g=u(h))return;if((p._=function(){}).via=n.leap=l,g=p.dam)return(g=n.hear[g])&&g(p,l,t),void s(h);var v,m=+new Date;d&&(d.is=m),t.on("in",p),d&&(d.hd=+new Date),console.STAT&&(v=+new Date-m)>9&&console.STAT(m,v,"msg"),s(h).via=l,n.leap=null}}else{try{p=JSON.parse(a)}catch(t){i.log("DAM JSON parse error",t)}if(a="",!p)return;console.STAT&&console.STAT(+new Date,p.length,"# on hear batch");var k=i.puff;!function t(){for(var n,e=+new Date,o=0;o<k&&(n=p[o++]);)f(n,l);p=p.slice(o),console.STAT&&console.STAT(e,+new Date-e,"hear loop"),c(l),p.length&&r(t,0)}()}}};function c(t){var n=t.batch,e="string"==typeof n;if(e&&(n+="]"),t.batch=t.tail=null,n&&(e?!(3>n.length):n.length)){if(!e)try{n=1===n.length?n[0]:JSON.stringify(n)}catch(t){return i.log("DAM JSON stringify error",t)}n&&l(n,t)}}function l(t,e){try{var o=e.wire;e.say?e.say(t):o.send&&o.send(t),n.say.d+=t.length||0,++n.say.c}catch(n){(e.queue=e.queue||[]).push(t)}}f.c=f.d=0,h=0,d=n.say=function(t,o){var u,f,g;if((u=this)&&(u=u.to)&&u.next&&u.next(t),!t)return!1;var v=t.DBG;o||(b=+new Date,v&&(v.y=b));var m=t._||(t._=function(){});if((f=t["#"])||(f=t["#"]=e.text.random(9)),(g=m.raw)||(g=n.raw(t)),b&&console.STAT&&console.STAT(b,+new Date-b,"say prep"),!p&&s(f),!o&&(u=t["@"])&&(o=(u=a.s[u])&&(u.via||(u=u.it)&&(u=u._)&&u.via)||n.leap),!o&&t["@"])return console.STAT&&console.STAT(+new Date,++h,"total no peer to ack to"),!1;if(!o&&n.way)return n.way(t);if(o&&o.id){if(!o.wire&&n.wire&&n.wire(o),f!==o.last){if(o.last=f,o===m.via)return!1;if((u=m.to)&&(u[o.url]||u[o.pid]||u[o.id]))return!1;if(o.batch){if(o.tail=(u=o.tail||0)+g.length,o.tail<=i.pack)return void(o.batch+=(u?",":"")+g);c(o)}o.batch="[";var k,b=+new Date;setTimeout(function(){console.STAT&&(k=+new Date-b)>9&&console.STAT(b,k,"0ms TO",f,o.id),c(o)},i.gap),l(g,o)}}else{if(!e.obj.is(o||i.peers))return!1;i.puff;var y=i.peers,_=Object.keys(o||i.peers||{});!function n(){var e=+new Date;p=1;var o=m.raw;m.raw=g;for(var i,a=0;a<9&&(i=(_||"")[a++]);)(i=y[i])&&d(t,i);m.raw=o,p=0,_=_.slice(a),console.STAT&&console.STAT(e,+new Date-e,"say loop"),_.length&&(r(n,0),s(t["@"]))}()}},n.say.c=n.say.d=0,function(){n.raw=function(n){if(!n)return"";var e,o=n._||{};if(e=o.raw)return e;if("string"==typeof n)return n;var i=t(n);return o&&(i||"").length<1e5&&(o.raw=i),i};var t=JSON.stringify}(),n.hi=function(o){var r=o.wire||{};o.id?i.peers[o.url||o.id]=o:(r=o.id=o.id||e.text.random(9),n.say({dam:"?",pid:t.opt.pid},i.peers[r]=o),delete a.s[o.last]),o.met=o.met||+new Date,r.hied||t.on(r.hied="hi",o),r=o.queue,o.queue=[],e.obj.map(r,function(t){l(t,o)}),e.obj.native&&e.obj.native()},n.bye=function(e){t.on("bye",e);var o=+new Date;o-=e.met||o,n.bye.time=((n.bye.time||o)+o)/2},n.hear["!"]=function(t,n){i.log("Error:",t.err)},n.hear["?"]=function(t,e){t.pid&&(e.pid||(e.pid=t.pid),t["@"])||(n.say({dam:"?",pid:i.pid,"@":t["#"]},e),delete a.s[e.last])},t.on("create",function(t){t.opt.pid=t.opt.pid||e.text.random(9),this.to.next(t),t.on("out",n.say)}),t.on("bye",function(t,n){t=i.peers[t.id||t]||t,this.to.next(t),t.bye?t.bye():(n=t.wire)&&n.close&&n.close(),e.obj.del(i.peers,t.id),t.wire=null});var p,h,d;var g={};return t.on("bye",function(t,n){this.to.next(t),(n=t.url)&&(g[n]=!0,setTimeout(function(){delete g[n]},i.lack||9e3))}),t.on("hi",function(o,r){this.to.next(o),(r=o.url)&&g[r]&&(delete g[r],i.super||e.obj.map(t.next,function(i,a){(r={})[a]=t.graph[a],n.say({"##":e.obj.hash(r),get:{"#":a}},o)}))}),n}}catch(t){}})(t,"./adapters/mesh"),t(function(n){var e=t("../index");e.Mesh=t("./mesh"),e.on("opt",function(t){this.to.next(t);var n=t.opt;if(!t.once&&!1!==n.WebSocket){var o;"undefined"!=typeof window&&(o=window),"undefined"!=typeof global&&(o=global),o=o||{};var i=n.WebSocket||o.WebSocket||o.webkitWebSocket||o.mozWebSocket;if(i){n.WebSocket=i;var r=n.mesh=n.mesh||e.Mesh(t);r.wire||n.wire;r.wire=n.wire=s,setTimeout(function(){t.on("out",{dam:"hi"})},1);var a=2e3,u="undefined"!=typeof document&&document}}function s(t){try{if(!t||!t.url)return o&&o(t);var e=t.url.replace(/^http/,"ws"),o=t.wire=new n.WebSocket(e);return o.onclose=function(){n.mesh.bye(t),f(t)},o.onerror=function(n){f(t)},o.onopen=function(){n.mesh.hi(t)},o.onmessage=function(e){e&&n.mesh.hear(e.data||e,t)},o}catch(t){}}function f(t){clearTimeout(t.defer),u&&t.retry<=0||(t.retry=(t.retry||n.retry||60)-1,t.defer=setTimeout(function n(){if(u&&u.hidden)return setTimeout(n,a);s(t)},a))}})})(t,"./adapters/websocket")}()